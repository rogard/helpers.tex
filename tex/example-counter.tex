\documentclass{article}

\usepackage{lipsum,tcolorbox,graphicx}
\tcbuselibrary{listings,raster,skins}
\newtcblisting{listing-tex}{
  listing and text,
  listing options={language=Tex, style=tcblatex}
}

\ExplSyntaxOn
\file_input:n{../tex/erw-counter.sty}
\ExplSyntaxOff
\CounterSetup{ new = foo }

\begin{document}

\begin{listing-tex}
  % \ExplSyntaxOn
  % \file_input:n{../tex/erw-counter.sty}
  % \ExplSyntaxOff
  % \CounterSetup{ new = foo }

  % Expected: 0
  Initial value: \CounterUse{foo}

  % Expected: 5
  Final value: \CounterRef{foo}{final}

  \CounterIncrement{foo}
  \CounterIncrement{foo}
  \CounterIncrement{foo}

  % Expected: 3
  Value after 3 increments: \CounterUse{foo}

  \CounterIncrement{foo}
  \CounterIncrement{foo}
  \CounterLabel{foo}{final}
\end{listing-tex}

\end{document}
